# -*- coding: utf-8 -*-
"""22app_imc_web.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1gjzTWTfT2Y0x2T3lamXqK8W7qXEfKoVW
"""

import streamlit as st
import pandas as pd
# import plotly.express as px # REMOVIDO: Esta linha causava o ModuleNotFoundError
# from datetime import datetime # REMOVIDO: Esta importa√ß√£o n√£o √© utilizada no c√≥digo atual

class CalculadoraIMC:
    def __init__(self):
        self.classificacoes = [
            {"max": 18.4, "cat": "Abaixo do peso", "desc": "Indicado buscar orienta√ß√£o para ganho de peso saud√°vel.", "cor": "warning"},
            {"max": 24.9, "cat": "Peso normal", "desc": "Seu peso est√° saud√°vel. Mantenha h√°bitos equilibrados.", "cor": "success"},
            {"max": 29.9, "cat": "Sobrepeso", "desc": "Recomenda-se orienta√ß√£o para plano de emagrecimento.", "cor": "warning"},
            {"max": 34.9, "cat": "Obesidade Grau I", "desc": "Acompanhamento profissional importante.", "cor": "danger"},
            {"max": 39.9, "cat": "Obesidade Grau II", "desc": "Risco elevado. Procure ajuda urgente.", "cor": "danger"},
            {"max": float('inf'), "cat": "Obesidade Grau III", "desc": "Risco muito elevado. Tratamento rigoroso.", "cor": "danger"}
        ]

    def calcular_imc(self, peso, altura):
        if altura <= 0 or peso <= 0:
            raise ValueError("Valores devem ser positivos.")
        return peso / (altura ** 2)

    def classificar_imc(self, imc):
        for classe in self.classificacoes:
            if imc <= classe["max"]:
                return (classe["cat"], classe["desc"], classe["cor"])
        return self.classificacoes[-1]['cat'], self.classificacoes[-1]['desc'], self.classificacoes[-1]['cor']

    def obter_dicas(self, classificacao, idade):
        dicas = [
            "### üìå Dicas Gerais para uma Alimenta√ß√£o Saud√°vel",
            "- **Priorize alimentos in natura ou minimamente processados:** Frutas, verduras, legumes, gr√£os inteiros, carnes magras, ovos.",
            "- **Evite alimentos ultraprocessados:** Refrigerantes, biscoitos recheados, salgadinhos, embutidos - ricos em a√ß√∫car, s√≥dio e gorduras n√£o saud√°veis.",
            "- **Cozinhe seus pr√≥prios alimentos:** Controle os ingredientes e qualidade das prepara√ß√µes.",
            "- **Fa√ßa refei√ß√µes conscientes:** Coma devagar, em ambiente tranquilo e preferencialmente em companhia.",
            "- **Hidrate-se adequadamente:** Beba √°gua ao longo do dia (6-8 copos di√°rios).",
            "- **Use √≥leos, sal e a√ß√∫car com modera√ß√£o:** Prefira vers√µes naturais e evite excessos.",
            "- **Mantenha-se ativo:** Combine alimenta√ß√£o saud√°vel com atividade f√≠sica regular.",
            "- **Varie os alimentos:** Consuma diferentes grupos alimentares ao longo da semana.",
            "- **Aten√ß√£o aos r√≥tulos:** Leia as informa√ß√µes nutricionais dos produtos industrializados."
        ]

        if "Abaixo do peso" in classificacao:
            dicas.extend([
                "\n### ü•ë Estrat√©gias para Ganho de Peso Saud√°vel - Recomenda√ß√µes M√©dicas de Prefer√™ncia:",
                "- Consuma alimentos ricos em nutrientes e calorias saud√°veis: abacate, azeite, castanhas",
                "- Fa√ßa 6 refei√ß√µes di√°rias em por√ß√µes menores",
                "- Inclua prote√≠nas em todas as refei√ß√µes principais",
                "- Consulte um nutricionista para plano individualizado"
            ])
        elif "Sobrepeso" in classificacao or "Obesidade" in classificacao:
            dicas.extend([
                "\n### ü•¶ Estrat√©gias para Emagrecimento Saud√°vel - Recomenda√ß√µes M√©dicas de Prefer√™ncia:",
                "- Aumente o consumo de fibras: vegetais folhosos, frutas com casca, gr√£os integrais",
                "- Consuma prote√≠nas magras: peixes, frango, ovos, leguminosas",
                "- Reduza o consumo de bebidas alco√≥licas",
                "- Consulte um nutricionista para plano individualizado",
                "- Reduza gradualmente o consumo de a√ß√∫cares e gorduras saturadas",
                "- Mantenha regularidade nas refei√ß√µes para evitar compuls√µes",
                "- Importante nesse processo - Pratique atividade f√≠sica regular com orienta√ß√£o profissional"
            ])
        elif "Peso normal" in classificacao:
            dicas.extend([
                "\n### ‚úÖ Mantenha seus H√°bitos Saud√°veis:",
                "- Continue com a rotina alimentar equilibrada",
                "- Monitore seu peso periodicamente",
                "- Experimente novas receitas saud√°veis",
                "- Importante nesse processo - Mantenha check-ups regulares"
            ])

        if idade < 18:
            dicas.extend([
                f"\n### üëß Considera√ß√µes para {idade} anos:",
                "- Fundamental papel da fam√≠lia na oferta de alimentos saud√°veis",
                "- Evite a√ß√∫car para menores de 2 anos e modere para maiores",
                "- Priorize lanches naturais: frutas, sandu√≠ches integrais",
                "- Mantenha hor√°rios regulares para as refei√ß√µes"
            ])
        elif idade >= 60:
            dicas.extend([
                f"\n### üëµ Considera√ß√µes para {idade} anos:",
                "- Aumente consumo de prote√≠nas para manter massa muscular",
                "- Aten√ß√£o √† hidrata√ß√£o (a sede pode diminuir com a idade)",
                "- Consuma alimentos ricos em c√°lcio e vitamina D",
                "- Adapte textura dos alimentos se necess√°rio"
            ])

        return "\n".join(dicas)

    def obter_resumos(self):
        return """
        ## üìö Refer√™ncias Cient√≠ficas

        ### Guias Oficiais:
        1. [Guia Alimentar para a Popula√ß√£o Brasileira](https://bvsms.saude.gov.br/bvs/publicacoes/guia_alimentar_populacao_brasileira_2ed.pdf)
        2. [Guia para Crian√ßas Menores de 2 Anos](https://bvsms.saude.gov.br/bvs/publicacoes/guia_alimentar_crianca_brasileira_versao_resumida.pdf)

        ### Estudos Relevantes:
        3. [Alimenta√ß√£o Saud√°vel](https://bvsms.saude.gov.br/bvs/publicacoes/alimentacao_saudavel.pdf)
        4. [Cl√≠nica Einstein: Dietas & Emagrecimento](https://vidasaudavel.einstein.br/wp-content/uploads/2021/02/98.-Dietas-Emagrecimento.pdf)
        """

# Configura√ß√£o da P√°gina
st.set_page_config(
    page_title="Orienta√ß√µes b√°sicas",
    page_icon="ü•ó",
    layout="wide",
    initial_sidebar_state="expanded"
)

# Interface Principal
st.title("ü•ó Calculadora de IMC")
st.markdown("""
    *Calculadora de IMC com orienta√ß√µes baseadas em evid√™ncias cient√≠ficas:*
""")

# Inicializa a calculadora
calc = CalculadoraIMC()

# Usamos um estado de sess√£o para controlar se j√° calculamos o IMC
if 'calculado' not in st.session_state:
    st.session_state.calculado = False

# Entradas do Usu√°rio dentro de um formul√°rio
with st.form(key='form_imc'):
    col1, col2, col3 = st.columns(3)
    with col1:
        peso = st.number_input("Peso (kg):", min_value=30.0, max_value=300.0, step=0.1, value=None, format="%.1f")
    with col2:
        altura = st.number_input("Altura (m):", min_value=1.0, max_value=2.5, step=0.01, value=None, format="%.2f")
    with col3:
        idade = st.number_input("Idade (anos):", min_value=2, max_value=120, step=1, value=None)

    if st.form_submit_button("Calcular IMC e Obter Orienta√ß√µes", type="primary"):
        if peso is None or altura is None or idade is None:
            st.error("Por favor, preencha todos os campos!")
        else:
            try:
                imc = calc.calcular_imc(peso, altura)
                classificacao, descricao, cor = calc.classificar_imc(imc)

                st.session_state.calculado = True

                st.success("An√°lise Completa Realizada!")

                with st.container():
                    col_res1, col_res2 = st.columns([1, 2])

                    with col_res1:
                        st.metric("IMC Calculado", f"{imc:.1f}")
                        st.markdown(f"""
                            **Classifica√ß√£o:**
                            :{cor}[**{classificacao}**]
                            _{descricao}_
                        """)
                        # O gr√°fico Plotly foi removido aqui.
                        st.info("O gr√°fico de IMC foi removido para evitar erros de depend√™ncia na publica√ß√£o. Se desejar, podemos explorar outras op√ß√µes de visualiza√ß√£o.")

                    with col_res2:
                        st.markdown(calc.obter_dicas(classificacao, idade))

                        with st.expander("üîç Refer√™ncias Cient√≠ficas", expanded=True):
                            st.markdown(calc.obter_resumos())

            except Exception as e:
                st.error(f"Erro: {str(e)}")

# --- Bot√£o "Novo C√°lculo" ---
if st.session_state.calculado:
    st.markdown("---")
    if st.button("Novo C√°lculo de IMC", key="novo_calculo_button"):
        st.session_state.calculado = False
        st.experimental_rerun()

st.markdown("---")
st.markdown("""
    **Desenvolvido por:** Marcia Romanato
""")